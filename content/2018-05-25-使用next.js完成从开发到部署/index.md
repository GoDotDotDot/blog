---
title: ä½¿ç”¨next.jså®Œæˆä»å¼€å‘åˆ°éƒ¨ç½²
path: blog/ä½¿ç”¨next.jså®Œæˆä»å¼€å‘åˆ°éƒ¨ç½²
date: 2018-05-25
tags: [reactjs, nodejs, nextjs]
cover: ./cover.png
categories: 2018Â·å‰ç«¯
description: ä½¿ç”¨next.jså®Œæˆä»å¼€å‘åˆ°éƒ¨ç½²ã€‚next.js æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„è½»é‡çº§çš„reactåŒæ„æ¡†æ¶ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿçš„å¼€å‘å‡ºåŸºäºæœåŠ¡ç«¯æ¸²æŸ“çš„reactåº”ç”¨ã€‚åœ¨next.js å®˜ç½‘æ¨èçš„æ˜¯ä½¿ç”¨nowæ¥éƒ¨ç½²åº”ç”¨ï¼Œä½†æ˜¯å¯¹äºå›½å†…ç”¨æˆ·æˆ–è€…è¯´æ˜¯æœ‰ç‰¹æ®Šéœ€æ±‚çš„ç”¨æˆ·æ¥è¯´ï¼Œéƒ¨ç½²åˆ°è‡ªå®šä¹‰æœåŠ¡å™¨ä¹Ÿè®¸æ˜¯å¤§å¤šæ•°äººå¸Œæœ›çš„ã€‚å€Ÿç€è¿‘æœŸå…¬å¸å®˜ç½‘æ”¹ç‰ˆï¼Œé¡ºä¾¿åˆ†äº«ä¸‹è‡ªå·±ä»å¼€å‘åˆ°éƒ¨ç½²è¿‡ç¨‹ä¸­æ‰€ç»å†çš„ç‚¹ç‚¹æ»´æ»´ã€‚
excerpt: ä½¿ç”¨next.jså®Œæˆä»å¼€å‘åˆ°éƒ¨ç½²ã€‚next.js æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„è½»é‡çº§çš„reactåŒæ„æ¡†æ¶ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿçš„å¼€å‘å‡ºåŸºäºæœåŠ¡ç«¯æ¸²æŸ“çš„reactåº”ç”¨ã€‚
---

# ä½¿ç”¨next.jså®Œæˆä»å¼€å‘åˆ°éƒ¨ç½²

[next.js](https://github.com/zeit/next.js) æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„è½»é‡çº§çš„`react`åŒæ„æ¡†æ¶ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿçš„å¼€å‘å‡ºåŸºäºæœåŠ¡ç«¯æ¸²æŸ“çš„`react`åº”ç”¨ã€‚åœ¨[next.js](https://github.com/zeit/next.js) å®˜ç½‘æ¨èçš„æ˜¯ä½¿ç”¨`now`æ¥éƒ¨ç½²åº”ç”¨ï¼Œä½†æ˜¯å¯¹äºå›½å†…ç”¨æˆ·æˆ–è€…è¯´æ˜¯æœ‰ç‰¹æ®Šéœ€æ±‚çš„ç”¨æˆ·æ¥è¯´ï¼Œéƒ¨ç½²åˆ°è‡ªå®šä¹‰æœåŠ¡å™¨ä¹Ÿè®¸æ˜¯å¤§å¤šæ•°äººå¸Œæœ›çš„ã€‚å€Ÿç€è¿‘æœŸå…¬å¸å®˜ç½‘æ”¹ç‰ˆï¼Œé¡ºä¾¿åˆ†äº«ä¸‹è‡ªå·±ä»å¼€å‘åˆ°éƒ¨ç½²è¿‡ç¨‹ä¸­æ‰€ç»å†çš„ç‚¹ç‚¹æ»´æ»´ã€‚

ä¾ç¨€è¿˜è®°å¾—ç¬¬ä¸€æ¬¡ä½¿ç”¨[next.js](https://github.com/zeit/next.js) æ˜¯åœ¨å»å¹´ï¼ˆ2017å¹´ï¼‰ï¼Œé‚£ä¸ªæ—¶å€™ä½¿ç”¨çš„æ˜¯[next.js](https://github.com/zeit/next.js)  2.xç‰ˆæœ¬ï¼Œ`react`è¿˜æ˜¯15ç‰ˆæœ¬ï¼Œä¸€å¹´è¿‡å»ï¼Œç°åœ¨`react`å·²ç»å‘å±•åˆ°16ç‰ˆæœ¬ï¼Œè€Œ[next.js](https://github.com/zeit/next.js) å·²ç»å‘å±•åˆ°6.0ç‰ˆæœ¬äº†ï¼Œè¿­ä»£é€Ÿåº¦ç ç›®ç»“èˆŒï¼Œåœ¨ä½¿ç”¨æ–°ç‰ˆæœ¬çš„è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯é‡åˆ°ä¸å°‘çš„å‘ã€‚

## ç”¨åˆ°çš„æŠ€æœ¯

å…ˆè¯´ä¸‹è¿™æ¬¡ç”¨åˆ°äº†å“ªäº›æŠ€æœ¯ï¼Œä¸‹é¢åˆ—ä¸¾äº†é¡¹ç›®ä¸­ä¸»è¦ç”¨åˆ°çš„æŠ€æœ¯æˆ–å·¥å…·åº“ã€‚

- [Koa 2](https://koajs.com/) 

> ç”±expressåŸç­äººé©¬å¼€å‘çš„ä¸‹ä¸€ä»£webæ¡†æ¶ï¼Œç”¨æ¥æä¾›webæœåŠ¡ã€‚

- [nginx](http://nginx.org/)

> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªIMAP/POP3/SMTPæœåŠ¡å™¨ï¼ˆæ‘˜è‡ªç™¾åº¦ç™¾ç§‘ï¼‰ï¼Œç”±ä¿„ç½—æ–¯äººå¼€å‘ã€‚ç”¨æ¥æä¾›é™æ€æ–‡ä»¶æœåŠ¡ã€httpsè¯ä¹¦ã€ä»£ç†æœåŠ¡ã€‚

- [react](https://reactjs.org/) 16.3

> ä¸€ä¸ªjavascript uiåº“


- [next.js ](https://nextjs.org/) 6.0.1

> ä¸€ä¸ªè½»é‡çº§çš„[react](https://reactjs.org/)åŒæ„åº”ç”¨æ¡†æ¶


- [ant design](https://ant.design)

> ç”±èš‚èšé‡‘æœå¼€å‘çš„åŸºäº`reactçš„`ä¸€å¥—ä¸­åå°äº§å“ç»„ä»¶åº“

- [react-motion](https://github.com/chenglou/react-motion)

> åŸºäº`react`çš„åŠ¨ç”»è§£å†³æ–¹æ¡ˆ

- [react-waypoint](https://github.com/brigade/react-waypoint)

> åˆ¤æ–­ç»„ä»¶æ˜¯å¦åœ¨å½“å‰å¯è§†åŒºçš„`react` ç»„ä»¶

- [pm2](https://github.com/Unitech/pm2)

> ä¸€ä¸ªå¸¦æœ‰è´Ÿè½½å‡è¡¡åŠŸèƒ½çš„Nodeåº”ç”¨çš„è¿›ç¨‹ç®¡ç†å™¨  

- [isomorphic-fetch](https://github.com/matthew-andrews/isomorphic-fetch)

> åŒæ„WHATWG Fetch API

## å¼€å‘é˜¶æ®µ 

è®²äº†è¿™ä¹ˆå¤šï¼Œè®©æˆ‘ä»¬è¿›å…¥å¼€å‘é˜¶æ®µï¼Œç¬¬ä¸€æ­¥æ„å»ºé¡¹ç›®æ¶æ„ï¼Œè¿™é‡Œåˆ†äº«ä¸‹è‡ªå·±çš„é¡¹ç›®ç»“æ„ï¼š

ğŸ“ **.vscode**

> `vscode` é…ç½®æ–‡ä»¶

ğŸ“  **component**

> [react](https://reactjs.org/)ç»„ä»¶

ğŸ“ **common**

> å…¬å…±éƒ¨åˆ†ï¼Œæˆ‘æ”¾ç½®çš„æ˜¯å¯¼èˆªæ ä¿¡æ¯ã€å…¨å±€å˜é‡å’Œå…¨å±€æ ·å¼ç­‰ç­‰

ğŸ“  **pages**

> é¡¹ç›®æ‰€æœ‰é¡µé¢å…¥å£ï¼Œä¹Ÿæ˜¯[next.js ](https://nextjs.org/) å„é¡µé¢å…¥å£æ–‡ä»¶

ğŸ“ **static**

> é™æ€æ–‡ä»¶

ğŸ“ **styles**

> å„é¡µé¢æ ·å¼è¡¨

ğŸ—„  **index.js** 

> nodeå¯åŠ¨æ–‡ä»¶

ğŸ—„ **.babelrc**

> [babel](http://babeljs.io/)é…ç½®æ–‡ä»¶

ğŸ—„ **.gitignore**

> git é…ç½®æ–‡ä»¶

ğŸ—„ **ecosystem.config.js**

> [pm2](https://github.com/Unitech/pm2)é…ç½®æ–‡ä»¶

ğŸ—„ **next.config.js**

> [next.js ](https://nextjs.org/)é…ç½®æ–‡ä»¶

ğŸ—„ **postcss.config.js**

> [postcss ](https://postcss.org/)é…ç½®æ–‡ä»¶

ğŸ—„ **nginx.conf**

> [nginx](http://nginx.org/)é…ç½®æ–‡ä»¶

ğŸ—„**package.json**

> npmé…ç½®æ–‡ä»¶

åœ¨å®Œæˆäº†é¡¹ç›®ç»“æ„é…ç½®ä¹‹åï¼Œå‡è®¾ä½ å·²ç»åœ¨`package.json`ä¸­ä¿å­˜äº†æˆ‘ä»¬æ‰€éœ€è¦çš„æ‰€æœ‰ä¾èµ–ï¼Œè®©æˆ‘ä»¬å°è¯•ç€è¾“å…¥`yarn`æ¥å®‰è£…ä¾èµ–ã€‚è¿™é‡Œå‡è®¾å®‰è£…ä¸€åˆ‡é¡ºåˆ©ï¼Œä¸‹é¢ç»§ç»­æˆ‘ä»¬çš„å¼€å‘ä¹‹æ—…ã€‚

é¦–å…ˆï¼Œåœ¨`pages`æ–‡ä»¶ä¸‹æ–°å»ºä¸€ä¸ª`index.js`ï¼Œè¿™é‡Œå°±éšä¾¿ä»æˆ‘çœŸå®é¡¹ç›®ä¸­æŠ½å–éƒ¨åˆ†ä»£ç æ¥ä½œå¸ˆèŒƒã€‚

```javascript
export default class HomePage extends React.Component {
  static async getInitialProps({ req, pathname }) {
    const data = await fetch(`${ctx}/api/projects/common/list`).then(res => res.json())
    .then(dt => dt)
    .catch(err => {
      return {
        success: false,
        message: err.message
      }
    })
    return { pathname,data };
  }

  render() {
    const { pathname, data } = this.props;
    return (
      <div>
         <Head>
          <title>é¦–é¡µ-æ˜“ç§‘æ·ï¼ˆæ­¦æ±‰ï¼‰ç”Ÿæ€ç§‘æŠ€æœ‰é™å…¬å¸</title>
        </Head>
        <div>Welcome to next.js!</div>
    	{/*è¿™é‡Œçœç•¥ä»£ç */}
      </div>
    );
  }
}

```

å¦‚æœä½ çš„`package.json`ä¸­æ²¡æœ‰é…ç½®`next`å¯åŠ¨è„šæœ¬ï¼Œè¯·è®¿é—®[setup](https://github.com/zeit/next.js#setup)è¿›è¡Œé…ç½®ï¼Œä¸‹é¢æˆ‘ä»¬åœ¨æ§åˆ¶å°è¿è¡Œ`npm run dev`ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œä½ å°†ä¼šçœ‹åˆ°`Welcome to next.js!`

åœ¨`next.js`ä¸­å¼€å‘ä½“éªŒå’Œ`react`å‡ ä¹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä½†æ˜¯åœ¨`webpack`é…ç½®è¿™å—å¯èƒ½éœ€è¦ä¸‹ç‚¹åŠŸå¤«ã€‚ä¸€äº›å¸¸ç”¨çš„æ’ä»¶åƒ`sass`ã€`css `ç­‰ï¼Œ  `next.js`éƒ½å·²ç»ç»™ä½ æä¾›äº†ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç¤¾åŒºå¼€æºçš„æ’ä»¶æ¥å®Œæˆä½ çš„å¼€å‘ä¹‹æ—…ã€‚è¯¦æƒ…è¯·æŸ¥çœ‹[next.jså®˜ç½‘](https://github.com/zeit/next.js)ã€‚

## éƒ¨ç½²

åœ¨ç»å†äº†å¼€å‘é˜¶æ®µã€æµ‹è¯•ç­‰ç­‰ä¸€ç³»åˆ—æµç¨‹ï¼Œç°åœ¨ç»ˆäºç­‰åˆ°äº†éƒ¨ç½²é˜¶æ®µã€‚åœ¨`next.js`ä¸­ç”Ÿäº§é˜¶æ®µæ‰“åŒ…åªéœ€è¦è¿è¡Œ`npm run build`å³å¯ï¼Œå®˜æ–¹æ¨èä¸ä¿®æ”¹æ‰“åŒ…çš„æ–‡ä»¶å¤¹åå­—ï¼ˆåŸåç§°ä¸º`.next`ï¼‰ï¼Œè¿™é‡Œä¸ªäººæ¨èä¿®æ”¹æˆ`build`æˆ–è€…`dist`è¿™äº›åç§°ã€‚åœ¨æ‰“åŒ…å®Œæˆä¹‹åï¼Œéœ€è¦ç¼–å†™`nodejs`å¯åŠ¨å…¥å£æ–‡ä»¶ï¼Œä¸‹é¢è´´å‡ºå®ä¾‹ä»£ç ï¼š

```javascript
const Koa = require('koa')
const next = require('next')
const Router = require('koa-router')

const port = parseInt(process.env.PORT, 10) || 3000
const dev = process.env.NODE_ENV !== 'production'
const app = next({ dev })
const handle = app.getRequestHandler()

app.prepare()
  .then(() => {
    const server = new Koa()
    const router = new Router()
	// é¦–é¡µ
    router.get('/', async ctx => {
      await app.render(ctx.req, ctx.res, '/', ctx.query)
      ctx.respond = false
    })
	// å…³äº
    router.get('/about', async ctx => {
      await app.render(ctx.req, ctx.res, '/about', ctx.query)
      ctx.respond = false
    })
	// äº§å“
    router.get('/products/:id', async ctx => {
      const {id} = ctx.params
      await app.render(ctx.req, ctx.res, `/products/${id}`, ctx.query)
      ctx.respond = false
    })
	// æ¡ˆä¾‹
    router.get('/case', async ctx => {
      await app.render(ctx.req, ctx.res, '/case', ctx.query)
      ctx.respond = false
    })
	// è”ç³»æˆ‘ä»¬
    router.get('/contact', async ctx => {
      await app.render(ctx.req, ctx.res, '/contact', ctx.query)
      ctx.respond = false
    })
	// è¯¦æƒ…
    router.get('/view/:type/:id', async ctx => {
      const {id, type} = ctx.params
      await app.render(ctx.req, ctx.res, `/view`, {id, type})
      ctx.respond = false
    })
    // å¦‚æœæ²¡æœ‰é…ç½®nginxåšé™æ€æ–‡ä»¶æœåŠ¡ï¼Œä¸‹é¢ä»£ç è¯·åŠ¡å¿…å¼€å¯
   /* router.get('*', async ctx => {
      await handle(ctx.req, ctx.res)
      ctx.respond = false
    })*/
    // é˜²æ­¢å‡ºç°æ§åˆ¶å°æŠ¥404é”™è¯¯
    server.use(async (ctx, next) => {
      ctx.res.statusCode = 200
      await next()
    })
    server.use(router.routes())
    server.listen(port, () => {
      console.log(`> Ready on http://localhost:${port}`)
    })
  })

```

ä¸€èˆ¬çš„é™æ€æ–‡ä»¶ã€gzipå‹ç¼©æ— éœ€äº¤ç»™`nodejs`æ¥åšï¼Œä¸ªäººä¸€ç›´è®¤ä¸ºä¸“ä¸šçš„äº‹äº¤ç»™ä¸“ä¸šçš„äººã€‚è¿™é‡Œå°†è¯¥é¡¹ä»»åŠ¡è½¬ç§»ç»™`nginx`ï¼Œç‰¹åˆ«æ³¨æ„ä¸Šé¢å®ä¾‹ä»£ç ä¸­æˆ‘æ³¨é‡Šçš„éƒ¨åˆ†ä»£ç ï¼Œè‹¥æœä½ æ²¡æœ‰ä½¿ç”¨`nginx`æ¥åšé™æ€æ–‡ä»¶æœåŠ¡ï¼Œè¯·åŠ¡å¿…å¼€å¯ï¼Œå¦åˆ™åƒ`next.js`æ‰“åŒ…å‡ºæ¥çš„`js`ã€`css`ã€å›¾ç‰‡æ–‡ä»¶ç­‰ï¼Œéƒ½å°†æŠ¥`404`ã€‚

åœ¨`next.js`ç”Ÿäº§æ‰“åŒ…é˜¶æ®µæ‰“åŒ…å‡ºæ¥çš„`js`æ–‡ä»¶è¯·æ±‚è·¯å¾„ä¸­å¸¦æœ‰ç‰ˆæœ¬å·ï¼Œè€ŒçœŸå®æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶å¤¹å´æ²¡æœ‰å®é™…å¯¹åº”çš„ç›®å½•ï¼Œä¹Ÿå°±æ˜¯æ‰“åŒ…å‡ºæ¥çš„æ˜¯è™šæ‹Ÿç›®å½•ï¼Œè¿™é‡Œå¦‚æœä½¿ç”¨`nginx`å°±éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚å¥½åœ¨`next.js`æä¾›é…ç½®é¡¹æ¥ä¿®æ”¹`build id`ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„çœŸå®ä»£ç ï¼š

```javascript
// next.config.js
module.exports = {
  generateBuildId: async () => {
    // For example get the latest git commit hash here
    return 'v1'
  }
}
```

è¿™æ ·æ‰“åŒ…å‡ºæ¥çš„è™šæ‹Ÿè·¯å¾„å¤§æ¦‚æ˜¯`_next/v1/page/xxx.js`ï¼Œå¦‚æœä½ ä½¿ç”¨`cdn`å‰ç¼€ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œä½†æ˜¯ç‰ˆæœ¬å·ä¾ç„¶å­˜åœ¨ã€‚

è¿˜æœ‰ä¸€ä¸ªå‘å°±æ˜¯`next.js`æ‰“åŒ…å‡ºæ¥çš„æœ‰ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼š`bundles`ã€`dist`ã€`static`ï¼Œå¯¹äºä¸çŸ¥é“æºç çš„äººæ¥è¯´ï¼Œæ ¹æœ¬ä¸çŸ¥é“å®é™…è¯·æ±‚æ–‡ä»¶åœ¨å“ªä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚äºæ˜¯æˆ‘å°±çœ‹`next.js`æºç ï¼Œå‘ç°å…¶å®æ‰¾çš„æ˜¯`bundle`æ–‡ä»¶ä¸‹çš„`page`ï¼Œæºç ä½ç½®ï¼š[L214](https://github.com/zeit/next.js/blob/e9242705a3c75fa480250ef623b926b6140b1bf5/server/index.js#L214)

æ‰€ä»¥åœ¨é…ç½®`nginx`å°±éœ€è¦ä½¿ç”¨åˆ«åã€‚ä¸‹é¢ç»™å‡ºä¸€æ®µæˆ‘çš„`nginx`çœŸå®é…ç½®ä»£ç ï¼š

```nginx
		# ç½‘ç«™æ ¹ç›®å½•æ–‡ä»¶
        location ~ ^/(robots.txt|humans.txt|favicon.ico|sw.js|baidu_verify_7Kj6tQjI3v.html) {
            root /home/website/eco_website_pc/static/;
            if ($request_filename ~* sw.js){
                    expires -1s;
                }
            expires 10m;

	    }
        # staticä¸‹çš„æ–‡ä»¶
        location ^~ /static/ {
            alias /home/website/eco_website_pc/static/;
            if ($request_filename ~* sw.js){
                    expires -1s;
                }
            expires 10m;

	    }
        # next pagesé¡µé¢ä¸‹çš„è„šæœ¬
        location ~ ^/(/_next/v1/) {
            alias /home/website/eco_website_pc/build/bundles/;
            if ($request_filename ~* sw.js){
                    expires -1s;
                }
            expires 10m;

	    }
        # next staticä¸‹çš„é™æ€æ–‡ä»¶
        location ~ ^/(/_next/static/) {
            root /home/website/eco_website_pc/build;
            if ($request_filename ~* sw.js){
                    expires -1s;
                }
            expires 10m;

	    }
```

é™æ€æ–‡ä»¶é…ç½®å¥½äº†å°±éœ€è¦é…ç½®`https`è¯ä¹¦äº†ï¼Œå› ä¸ºæˆ‘ä»¬è¿™æ¬¡é¡¹ç›®æ˜¯å…¬å¸å®˜ç½‘ï¼Œè¯ä¹¦æˆ‘å°±è‡ªå·±å»å…è´¹å¼„äº†ä¸€ä¸ªï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„[freessl](https://freessl.org/)ä¸Šé¢æä¾›çš„äºšæ´²è¯šä¿¡çš„è¯ä¹¦ã€‚åœ¨ç”³è¯·å®Œ`ssl`è¯ä¹¦ä¹‹åéœ€è¦å»åŸŸåæä¾›å•†é‚£é‡Œå»é…ç½®`TXT`è®°å½•ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘ï¼Œåœ¨å®ŒæˆéªŒè¯åï¼Œ[freessl](https://freessl.org/)å°†ä¼šä¸‹è½½è¯ä¹¦ï¼Œæ‹¿åˆ°è¯¥è¯ä¹¦ä¹‹åéœ€è¦å»é…ç½®`nginx` `ssl`è¯ä¹¦ï¼Œä¸‹é¢è´´å‡ºæˆ‘çš„å®Œæ•´é…ç½®ï¼š

```nginx
server {
        listen       80;
        listen       443 ssl;
        server_name  wh-eco.com;
        charset utf-8;
        ssl_certificate /home/website/ssl/www/full_chain.pem;
        ssl_certificate_key /home/website/ssl/www/private.key;
        fastcgi_param   HTTPS               on;
        fastcgi_param   HTTP_SCHEME         https;

        if ($scheme = http ) {
          return 301 https://$host$request_uri;
        }
        access_log      /var/log/nginx/www.wh-eco.com.access.log;
        error_log       /var/log/nginx/www.wh-eco.com.error.log;
        location / {
            proxy_pass http://127.0.0.1:xxxx; #ä¿å¯† 0.0
            proxy_set_header Host $host;
            #proxy_redirect off;
            proxy_set_header    REMOTE-HOST $remote_addr;
        	# ç½‘ç«™å¯èƒ½åæœŸä¼šä½¿ç”¨websocket ç‰¹æ¬¡å‡çº§è¯·æ±‚åè®®
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	        proxy_connect_timeout 60;
            proxy_read_timeout 600;
            proxy_send_timeout 600;
        }
        # ç½‘ç«™æ ¹ç›®å½•æ–‡ä»¶
        location ~ ^/(robots.txt|humans.txt|favicon.ico|sw.js|baidu_verify_7Kj6tQjI3v.html) {
            root /home/website/eco_website_pc/static/;
            if ($request_filename ~* sw.js){
                    expires -1s;
                }
            expires 10m;

	    }
        # staticä¸‹çš„æ–‡ä»¶
        location ^~ /static/ {
            alias /home/website/eco_website_pc/static/;
            if ($request_filename ~* sw.js){
                    expires -1s;
                }
            expires 10m;

	    }
        # next pagesé¡µé¢ä¸‹çš„è„šæœ¬
        location ~ ^/(/_next/v1/) {
            alias /home/website/eco_website_pc/build/bundles/;
            if ($request_filename ~* sw.js){
                    expires -1s;
                }
            expires 10m;

	    }
        # next staticä¸‹çš„é™æ€æ–‡ä»¶
        location ~ ^/(/_next/static/) {
            root /home/website/eco_website_pc/build;
            if ($request_filename ~* sw.js){
                    expires -1s;
                }
            expires 10m;

	    }
        error_page   500 502 503 504 = /error.html;
        error_page  404 = /notfound.html;
        location = /error.html {
                root   /home;
            }
        location = /notfound.html{
            root  /home;
        }
    }
```

è‡³äº`gzip`ä½ å¯ä»¥æ ¹æ®ä½ è¦æ±‚æ¥åšé…ç½®ï¼Œè´´ä¸€ä¸ªæˆ‘çš„ç¤ºä¾‹é…ç½®ï¼š

```nginx
 	gzip  on;
    gzip_comp_level 6;
    gzip_vary on;
    gzip_types
        application/atom+xml
        application/javascript
        application/json
        application/rss+xml
        application/vnd.ms-fontobject
        application/x-font-ttf
        application/x-web-app-manifest+json
        application/xhtml+xml
        application/xml
        font/opentype
        image/svg+xml
        image/x-icon
        image/jpeg 
        image/gif 
        image/png
        text/css
        text/plain
        text/x-component;
```

åœ¨å®Œæˆ`nginx`é…ç½®ä¹‹åéœ€è¦åšçš„æ˜¯ä»¥`pm2`æ–¹å¼å¯åŠ¨æ•´ä¸ªåº”ç”¨

```shell
pm2 start ecosystem.config.js
```

åœ¨è¿è¡Œå®Œä¸Šè¿°å‘½ä»¤åï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ å°±å¯ä»¥è¾“å…¥åŸŸåæ¥è®¿é—®ä½ çš„åº”ç”¨äº†ï¼ˆå‡è®¾ä½ å·²ç»å®Œæˆäº†åŸŸåè§£æå·¥ä½œï¼‰ã€‚

## æ€»ç»“

ä¸€å…¥å‰ç«¯æ·±ä¼¼æµ·

--------------------

[Github](https://github.com/GoDotDotDot)  |  [åšå®¢](https://blog.godotdotdot.com/)





